{"version":3,"file":"extension.js","sources":["../src/types.ts","../src/utils.ts","../src/messageHandlers.ts","../src/treeView.ts","../src/panelProvider.ts","../src/extension.ts"],"sourcesContent":["// 支持的图片格式\nexport const IMAGE_EXTENSIONS = ['.svg', '.png', '.jpg', '.jpeg', '.gif', '.webp', '.ico', '.bmp'];\n\n// 图片文件接口\nexport interface ImageFile {\n  name: string;\n  path: string;\n  uri: string;\n  type: 'svg' | 'image';\n  extension: string;\n}\n\n// 树节点类型\nexport type TreeNodeType = 'folder' | 'imageFile';\n","import * as vscode from 'vscode';\nimport * as path from 'path';\nimport * as fs from 'fs';\nimport { ImageFile, IMAGE_EXTENSIONS } from './types';\n\n// 扫描目录获取所有图片\nexport async function scanDirectory(dirPath: string): Promise<ImageFile[]> {\n  const images: ImageFile[] = [];\n\n  async function scan(dir: string) {\n    const entries = fs.readdirSync(dir, { withFileTypes: true });\n\n    for (const entry of entries) {\n      const fullPath = path.join(dir, entry.name);\n\n      if (entry.isDirectory()) {\n        await scan(fullPath);\n      } else if (entry.isFile()) {\n        const imageFile = createImageFile(fullPath);\n        if (imageFile) {\n          images.push(imageFile);\n        }\n      }\n    }\n  }\n\n  await scan(dirPath);\n  return images;\n}\n\n// 创建图片文件对象\nexport function createImageFile(filePath: string): ImageFile | null {\n  const ext = path.extname(filePath).toLowerCase();\n\n  if (IMAGE_EXTENSIONS.includes(ext)) {\n    return {\n      name: path.basename(filePath),\n      path: filePath,\n      uri: filePath,\n      type: ext === '.svg' ? 'svg' : 'image',\n      extension: ext.slice(1)\n    };\n  }\n\n  return null;\n}\n\n// 生成 Webview 内容\nexport function getWebviewContent(\n  webview: vscode.Webview,\n  context: vscode.ExtensionContext,\n  images: ImageFile[]\n): string {\n  const scriptUri = webview.asWebviewUri(\n    vscode.Uri.file(path.join(context.extensionPath, 'dist', 'webview', 'index.js'))\n  );\n  const styleUri = webview.asWebviewUri(\n    vscode.Uri.file(path.join(context.extensionPath, 'dist', 'webview', 'index.css'))\n  );\n\n  // 转换图片路径为 webview URI\n  const imagesWithUri = images.map(img => ({\n    ...img,\n    uri: webview.asWebviewUri(vscode.Uri.file(img.path)).toString()\n  }));\n\n  const nonce = getNonce();\n\n  return `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'none'; style-src ${webview.cspSource} 'unsafe-inline'; script-src 'nonce-${nonce}'; img-src ${webview.cspSource} data: https:; font-src ${webview.cspSource};\">\n  <link rel=\"stylesheet\" href=\"${styleUri}\">\n  <title>Image Viewer</title>\n</head>\n<body>\n  <div id=\"root\"></div>\n  <script nonce=\"${nonce}\">\n    window.__IMAGES__ = ${JSON.stringify(imagesWithUri)};\n  </script>\n  <script nonce=\"${nonce}\" src=\"${scriptUri}\"></script>\n</body>\n</html>`;\n}\n\n// 生成随机 nonce\nexport function getNonce(): string {\n  let text = '';\n  const possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  for (let i = 0; i < 32; i++) {\n    text += possible.charAt(Math.floor(Math.random() * possible.length));\n  }\n  return text;\n}\n","import * as vscode from 'vscode';\n\n// 消息处理接口\nexport interface WebviewMessage {\n  command: string;\n  path?: string;\n  url?: string;\n}\n\n// 在资源管理器中定位文件\nexport function openSvgInLocate(svgUri: vscode.Uri) {\n  const uri = vscode.Uri.file(svgUri.fsPath);\n\n  vscode.commands.executeCommand('revealInExplorer', uri).then(undefined, err => {\n    vscode.window.showErrorMessage(`无法定位 SVG: ${err}`);\n  });\n}\n\n// 在编辑器中打开文件\nexport function openSvgInEditor(svgUri: vscode.Uri) {\n  vscode.workspace.openTextDocument(svgUri).then(doc => {\n    vscode.window.showTextDocument(doc, {\n      preview: false,  // 如果为 true，重复打开同一个文件会复用 tab\n      viewColumn: vscode.ViewColumn.One // 打开在第一个编辑器列\n    });\n  }, err => {\n    vscode.window.showErrorMessage(`无法打开 SVG: ${err}`);\n  });\n}\n\n// 统一的消息处理函数\nexport function handleWebviewMessage(message: WebviewMessage) {\n  console.log('Received message:', message);\n\n  switch (message.command) {\n    case 'open-svg':\n      if (message.path) {\n        const svgUri = vscode.Uri.file(message.path);\n        openSvgInEditor(svgUri);\n      }\n      break;\n\n    case 'open-web':\n      if (message.url) {\n        vscode.env.openExternal(vscode.Uri.parse(message.url));\n      }\n      break;\n\n    case 'go-to-svg':\n      if (message.path) {\n        const svgUri = vscode.Uri.file(message.path);\n        openSvgInLocate(svgUri);\n      }\n      break;\n  }\n}\n","import * as vscode from 'vscode';\nimport * as path from 'path';\nimport * as fs from 'fs';\nimport { ImageFile, TreeNodeType, IMAGE_EXTENSIONS } from './types';\n\n// 树节点\nexport class ImageTreeItem extends vscode.TreeItem {\n  constructor(\n    public readonly label: string,\n    public readonly collapsibleState: vscode.TreeItemCollapsibleState,\n    public readonly nodePath: string,\n    public readonly nodeType: TreeNodeType,\n    public readonly imageCount?: number\n  ) {\n    super(label, collapsibleState);\n\n    this.contextValue = nodeType;\n    this.tooltip = nodePath;\n\n    if (nodeType === 'folder') {\n      this.iconPath = new vscode.ThemeIcon('folder');\n      this.description = imageCount ? `${imageCount} images` : '';\n    } else {\n      const ext = path.extname(nodePath).toLowerCase();\n      if (ext === '.svg') {\n        this.iconPath = new vscode.ThemeIcon('symbol-misc');\n      } else {\n        this.iconPath = new vscode.ThemeIcon('file-media');\n      }\n      this.description = ext.slice(1).toUpperCase();\n      this.command = {\n        command: 'SVGViewer.openFromTree',\n        title: 'Open in SVG Viewer',\n        arguments: [vscode.Uri.file(nodePath)]\n      };\n    }\n\n    this.resourceUri = vscode.Uri.file(nodePath);\n  }\n}\n\n// 树数据提供者\nexport class ImageTreeDataProvider implements vscode.TreeDataProvider<ImageTreeItem> {\n  private _onDidChangeTreeData = new vscode.EventEmitter<ImageTreeItem | undefined | null | void>();\n  readonly onDidChangeTreeData = this._onDidChangeTreeData.event;\n\n  private _imageCache: Map<string, ImageFile[]> = new Map();\n\n  constructor(private readonly context: vscode.ExtensionContext) { }\n\n  refresh(): void {\n    this._imageCache.clear();\n    this._onDidChangeTreeData.fire();\n  }\n\n  getTreeItem(element: ImageTreeItem): vscode.TreeItem {\n    return element;\n  }\n\n  async getChildren(element?: ImageTreeItem): Promise<ImageTreeItem[]> {\n    if (!vscode.workspace.workspaceFolders) {\n      return [];\n    }\n\n    if (!element) {\n      // 根节点：显示工作区文件夹\n      const items: ImageTreeItem[] = [];\n      for (const folder of vscode.workspace.workspaceFolders) {\n        const images = await this.scanDirectoryForTree(folder.uri.fsPath);\n        if (images.length > 0) {\n          items.push(new ImageTreeItem(\n            folder.name,\n            vscode.TreeItemCollapsibleState.Expanded,\n            folder.uri.fsPath,\n            'folder',\n            images.length\n          ));\n          this._imageCache.set(folder.uri.fsPath, images);\n        }\n      }\n      return items;\n    }\n\n    // 子节点\n    if (element.nodeType === 'folder') {\n      return this.getChildrenForFolder(element.nodePath);\n    }\n\n    return [];\n  }\n\n  private async getChildrenForFolder(folderPath: string): Promise<ImageTreeItem[]> {\n    const items: ImageTreeItem[] = [];\n    const entries = fs.readdirSync(folderPath, { withFileTypes: true });\n\n    // 先处理文件夹\n    for (const entry of entries) {\n      if (entry.isDirectory() && !entry.name.startsWith('.') && entry.name !== 'node_modules') {\n        const subPath = path.join(folderPath, entry.name);\n        const images = await this.scanDirectoryForTree(subPath);\n        if (images.length > 0) {\n          items.push(new ImageTreeItem(\n            entry.name,\n            vscode.TreeItemCollapsibleState.Collapsed,\n            subPath,\n            'folder',\n            images.length\n          ));\n          this._imageCache.set(subPath, images);\n        }\n      }\n    }\n\n    // 再处理图片文件\n    for (const entry of entries) {\n      if (entry.isFile()) {\n        const ext = path.extname(entry.name).toLowerCase();\n        if (IMAGE_EXTENSIONS.includes(ext)) {\n          const filePath = path.join(folderPath, entry.name);\n          items.push(new ImageTreeItem(\n            entry.name,\n            vscode.TreeItemCollapsibleState.None,\n            filePath,\n            'imageFile'\n          ));\n        }\n      }\n    }\n\n    return items;\n  }\n\n  private async scanDirectoryForTree(dirPath: string): Promise<ImageFile[]> {\n    const images: ImageFile[] = [];\n\n    const scan = (dir: string) => {\n      try {\n        const entries = fs.readdirSync(dir, { withFileTypes: true });\n        for (const entry of entries) {\n          const fullPath = path.join(dir, entry.name);\n          if (entry.isDirectory() && !entry.name.startsWith('.') && entry.name !== 'node_modules') {\n            scan(fullPath);\n          } else if (entry.isFile()) {\n            const ext = path.extname(entry.name).toLowerCase();\n            if (IMAGE_EXTENSIONS.includes(ext)) {\n              images.push({\n                name: entry.name,\n                path: fullPath,\n                uri: fullPath,\n                type: ext === '.svg' ? 'svg' : 'image',\n                extension: ext.slice(1)\n              });\n            }\n          }\n        }\n      } catch (e) {\n        // 忽略权限错误\n      }\n    };\n\n    scan(dirPath);\n    return images;\n  }\n\n  // 获取指定文件夹下的所有图片\n  getImagesForPath(folderPath: string): ImageFile[] {\n    return this._imageCache.get(folderPath) || [];\n  }\n}\n","import * as vscode from 'vscode';\nimport * as path from 'path';\nimport { ImageFile } from './types';\nimport { getWebviewContent } from './utils';\nimport { handleWebviewMessage } from './messageHandlers';\n\n// 底部 Panel 的 WebviewViewProvider\nexport class SVGViewerPanelProvider implements vscode.WebviewViewProvider {\n  public static readonly viewType = 'svgViewer.panelView';\n  private _view?: vscode.WebviewView;\n  private _images: ImageFile[] = [];\n\n  constructor(private readonly _context: vscode.ExtensionContext) { }\n\n  public resolveWebviewView(\n    webviewView: vscode.WebviewView,\n    _context: vscode.WebviewViewResolveContext,\n    _token: vscode.CancellationToken\n  ) {\n    this._view = webviewView;\n\n    webviewView.webview.options = {\n      enableScripts: true,\n      localResourceRoots: [\n        vscode.Uri.file(path.join(this._context.extensionPath, 'dist')),\n        ...(vscode.workspace.workspaceFolders?.map(f => f.uri) || [])\n      ]\n    };\n\n    // 设置消息处理\n    webviewView.webview.onDidReceiveMessage(\n      message => handleWebviewMessage(message),\n      undefined,\n      this._context.subscriptions\n    );\n\n    // 初始化时显示空状态或已有的图片\n    this._updateWebview();\n  }\n\n  // 更新 Panel 中显示的图片\n  public updateImages(images: ImageFile[], rootPath: string) {\n    this._images = images;\n\n    if (this._view) {\n      // 更新 localResourceRoots 以包含新的路径\n      this._view.webview.options = {\n        enableScripts: true,\n        localResourceRoots: [\n          vscode.Uri.file(path.join(this._context.extensionPath, 'dist')),\n          vscode.Uri.file(rootPath),\n          ...(vscode.workspace.workspaceFolders?.map(f => f.uri) || [])\n        ]\n      };\n      this._updateWebview();\n      this._view.show?.(true); // 显示 panel\n    }\n  }\n\n  private _updateWebview() {\n    if (!this._view) {\n      return;\n    }\n\n    this._view.webview.html = getWebviewContent(\n      this._view.webview,\n      this._context,\n      this._images\n    );\n  }\n\n  // 获取当前 view\n  public get view(): vscode.WebviewView | undefined {\n    return this._view;\n  }\n}\n","import * as vscode from 'vscode';\nimport * as path from 'path';\nimport * as fs from 'fs';\n\nimport { ImageFile } from './types';\nimport { scanDirectory, createImageFile, getWebviewContent } from './utils';\nimport { handleWebviewMessage } from './messageHandlers';\nimport { ImageTreeItem, ImageTreeDataProvider } from './treeView';\nimport { SVGViewerPanelProvider } from './panelProvider';\n\nexport function activate(context: vscode.ExtensionContext) {\n  // 注册树视图数据提供者\n  const treeDataProvider = new ImageTreeDataProvider(context);\n  const treeView = vscode.window.createTreeView('svgViewer.imageTree', {\n    treeDataProvider\n  });\n  context.subscriptions.push(treeView);\n\n  // 注册底部 Panel Provider\n  const panelProvider = new SVGViewerPanelProvider(context);\n  context.subscriptions.push(\n    vscode.window.registerWebviewViewProvider(\n      SVGViewerPanelProvider.viewType,\n      panelProvider,\n      {\n        webviewOptions: {\n          retainContextWhenHidden: true\n        }\n      }\n    )\n  );\n\n  // 刷新命令\n  const refreshDisposable = vscode.commands.registerCommand('SVGViewer.refresh', () => {\n    treeDataProvider.refresh();\n  });\n\n  // 原有的命令：在编辑器区域打开 WebviewPanel\n  const disposable = vscode.commands.registerCommand('SVGViewer.open', async (uri: vscode.Uri) => {\n    let targetPath: string;\n\n    if (uri) {\n      targetPath = uri.fsPath;\n    } else {\n      // 如果没有传入 URI，尝试从当前选中的树节点或活动编辑器获取\n      const activeEditor = vscode.window.activeTextEditor;\n      if (activeEditor) {\n        targetPath = activeEditor.document.uri.fsPath;\n      } else if (vscode.workspace.workspaceFolders?.[0]) {\n        targetPath = vscode.workspace.workspaceFolders[0].uri.fsPath;\n      } else {\n        vscode.window.showErrorMessage('No file or folder selected');\n        return;\n      }\n    }\n\n    await openInViewer(targetPath, context);\n  });\n\n  // 从树视图打开\n  const openFromTreeDisposable = vscode.commands.registerCommand('SVGViewer.openFromTree', async (arg: vscode.Uri | ImageTreeItem) => {\n    let targetPath: string | undefined;\n\n    if (arg instanceof vscode.Uri) {\n      targetPath = arg.fsPath;\n    } else if (arg && typeof arg === 'object' && 'nodePath' in arg) {\n      // 从树节点右键菜单调用\n      targetPath = (arg as ImageTreeItem).nodePath;\n    } else if (arg && typeof arg === 'object' && 'fsPath' in arg) {\n      // 兼容其他 URI 类似对象\n      targetPath = (arg as { fsPath: string }).fsPath;\n    }\n\n    if (targetPath) {\n      await openInViewer(targetPath, context);\n    } else {\n      vscode.window.showErrorMessage('No file or folder selected');\n    }\n  });\n\n  // 新命令：在底部 Panel 中打开\n  const openInPanelDisposable = vscode.commands.registerCommand('SVGViewer.openInPanel', async (uri: vscode.Uri) => {\n    let targetPath: string;\n\n    if (uri) {\n      targetPath = uri.fsPath;\n    } else {\n      const activeEditor = vscode.window.activeTextEditor;\n      if (activeEditor) {\n        targetPath = activeEditor.document.uri.fsPath;\n      } else if (vscode.workspace.workspaceFolders?.[0]) {\n        targetPath = vscode.workspace.workspaceFolders[0].uri.fsPath;\n      } else {\n        vscode.window.showErrorMessage('No file or folder selected');\n        return;\n      }\n    }\n\n    await openInPanel(targetPath, context, panelProvider);\n  });\n\n  // 从树视图在 Panel 中打开\n  const openInPanelFromTreeDisposable = vscode.commands.registerCommand('SVGViewer.openInPanelFromTree', async (arg: vscode.Uri | ImageTreeItem) => {\n    let targetPath: string | undefined;\n\n    if (arg instanceof vscode.Uri) {\n      targetPath = arg.fsPath;\n    } else if (arg && typeof arg === 'object' && 'nodePath' in arg) {\n      // 从树节点右键菜单调用\n      targetPath = (arg as ImageTreeItem).nodePath;\n    } else if (arg && typeof arg === 'object' && 'fsPath' in arg) {\n      // 兼容其他 URI 类似对象\n      targetPath = (arg as { fsPath: string }).fsPath;\n    }\n\n    if (targetPath) {\n      await openInPanel(targetPath, context, panelProvider);\n    } else {\n      vscode.window.showErrorMessage('No file or folder selected');\n    }\n  });\n\n  context.subscriptions.push(\n    disposable,\n    refreshDisposable,\n    openFromTreeDisposable,\n    openInPanelDisposable,\n    openInPanelFromTreeDisposable\n  );\n}\n\n// 在编辑器区域打开查看器\nasync function openInViewer(targetPath: string, context: vscode.ExtensionContext) {\n  const stat = fs.statSync(targetPath);\n  let images: ImageFile[] = [];\n\n  if (stat.isDirectory()) {\n    images = await scanDirectory(targetPath);\n  } else {\n    const imageFile = createImageFile(targetPath);\n    if (imageFile) {\n      images = [imageFile];\n    }\n  }\n\n  if (images.length === 0) {\n    vscode.window.showInformationMessage('No images found in the selected location');\n    return;\n  }\n\n  const panel = vscode.window.createWebviewPanel(\n    'svgViewer',\n    `Image Viewer - ${path.basename(targetPath)}`,\n    vscode.ViewColumn.One,\n    {\n      enableScripts: true,\n      retainContextWhenHidden: true,\n      localResourceRoots: [\n        vscode.Uri.file(path.join(context.extensionPath, 'dist')),\n        vscode.Uri.file(stat.isDirectory() ? targetPath : path.dirname(targetPath))\n      ]\n    }\n  );\n\n  // 使用统一的消息处理\n  panel.webview.onDidReceiveMessage(\n    message => handleWebviewMessage(message),\n    undefined,\n    context.subscriptions\n  );\n\n  panel.webview.html = getWebviewContent(panel.webview, context, images);\n}\n\n// 在底部 Panel 中打开\nasync function openInPanel(targetPath: string, context: vscode.ExtensionContext, panelProvider: SVGViewerPanelProvider) {\n  const stat = fs.statSync(targetPath);\n  let images: ImageFile[] = [];\n\n  if (stat.isDirectory()) {\n    images = await scanDirectory(targetPath);\n  } else {\n    const imageFile = createImageFile(targetPath);\n    if (imageFile) {\n      images = [imageFile];\n    }\n  }\n\n  if (images.length === 0) {\n    vscode.window.showInformationMessage('No images found in the selected location');\n    return;\n  }\n\n  // 更新底部 Panel 的内容\n  const rootPath = stat.isDirectory() ? targetPath : path.dirname(targetPath);\n  panelProvider.updateImages(images, rootPath);\n\n  // 聚焦到底部 Panel\n  vscode.commands.executeCommand('svgViewer.panelView.focus');\n}\n\nexport function deactivate() { }\n"],"names":["fs","path","vscode"],"mappings":"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"}